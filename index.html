<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<script>

  const client = mqtt.connect("ws://meow4.mdbiot.com:1884/mqtt", {
      protocol: "ws",
      clientId: "web_" + Math.random().toString(16).substr(2, 8),
      clean: true,
      reconnectPeriod: 1000,
  });

  client.on("connect", () => {
    console.log("MQTT Connected (WS)!");
    client.subscribe("meow/sn123");
  });

  client.on("error", (err) => {
    console.error("MQTT Error: ", err);
  });

  client.on("message", (topic, msg) => {
    document.getElementById("status").innerText = msg.toString();
  });

  function saveConfig() {
    const payload = {
      mode: "wifi_config",
      ssid: document.getElementById("ssid").value,
      password: document.getElementById("password").value
    };
    client.publish("res/sn123", JSON.stringify(payload));
  }

  function toggleRelay() {
    client.publish("res/sn123",
      JSON.stringify({mode:"write", RL1:"1"})
    );
  }

</script>
